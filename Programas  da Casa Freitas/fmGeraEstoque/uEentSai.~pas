unit uEentSai;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, ExtCtrls, DB, ADODB;

type
  TfmEntSai = class(TForm)
    Label1: TLabel;
    Label4: TLabel;
    lbDesc: TLabel;
    lbis_ref: TLabel;
    lbTotEnt: TLabel;
    Label5: TLabel;
    lbTotVenda: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    lbPrimEnt: TLabel;
    Bevel1: TBevel;
    Bevel2: TBevel;
    qrEnt: TADOQuery;
    procedure listaTotalEntSai(isref:String);
    procedure listaPrimeiraEntrada(isref: String);
    procedure ObterTotalEntradas(Sender:Tobject);
    procedure ObtertotalVendas(Sender:Tobject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  fmEntSai: TfmEntSai;

implementation

uses uMain, funcsql, funcoes, uCF;

{$R *.dfm}

{ TfmEntSai }

{ TfmEntSai }

procedure TfmEntSai.listaTotalEntSai(isref: String);
begin //
    list


end;


procedure TfmEntSai.listaPrimeiraEntrada(isref: String);
var
   cmd:string;
begin
   cmd := 'Exec dbo.Z_CF_stoListaQtEntradaPorItem '+ isref;
   funcsql.getQuery(fmMain.Conexao, qrEnt, cmd );

   if (qrEnt.IsEmpty = false)then
   begin
      cmd := qrEnt.fieldByName('data').asString;
      insert('20', cmd, length(cmd)-1);
      lbPrimEnt.Caption := cmd;

       ObterTotalEntradas(nil);
       ObtertotalVendas(nil);
   end
   else
       lbPrimEnt.Caption := 'Não há...';
end;


procedure TfmEntSai.ObterTotalEntradas(Sender: Tobject);
var
  total:integer;
begin
   total := 0 ;
   qrEnt.First;
   while (qrEnt.Eof = false) do
   begin
      total :=  total + qrEnt.FieldByName('quant').AsInteger;
      qrEnt.Next();
   end;

   if total = 0 then
     lbTotEnt.Caption := '0'
   else
      lbTotEnt.Caption := floattostrf(total, ffNumber, 18, 0);
   qrEnt.Free();
end;

procedure TfmEntSai.ObtertotalVendas(Sender: Tobject);
begin
{   shortdateformat := 'dd/MM/yyyy';
   fmMain.CalculaVendaNoPeriodo(
                                 funcSQl.getCodUo('') ,
                                 lbis_ref.Caption,
                                 lbPrimEnt.Caption,
                                 dateToStr( now),
                                 '',
                                 '',
                                 false
     );
}
//    lbTotVenda.Caption :=   uCF.getVendaProduto(lbis_ref.Caption,  ;

   shortdateformat := 'dd/MM/yy';
}end;

end.
