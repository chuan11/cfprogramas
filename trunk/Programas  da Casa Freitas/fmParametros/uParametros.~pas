unit uParametros;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Grids, DBGrids, SoftDBGrid, DB, ADODB, StdCtrls, adLabelComboBox, funcsql;

type
  TfmParametros = class(TForm)
    gdParam: TSoftDBGrid;
    cbParametros: TadLabelComboBox;
    tbParam: TADOTable;
    DataSource1: TDataSource;
    procedure FormActivate(Sender: TObject);
    procedure carregaListaParametros();
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure cbParametrosChange(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  fmParametros: TfmParametros;

implementation

uses uMain;

{$R *.dfm}

procedure TfmParametros.carregaListaParametros;
begin
   tbParam.TableName := 'zcf_paramGerais';
   if (tbParam.Active = true) then
     tbParam.Close();

   if (cbParametros.ItemIndex > 0) then
   begin
      tbParam.Filtered := true;
      tbParam.Filter := 'nm_param = ' + quotedStr(cbParametros.Items[cbParametros.ItemIndex]);
   end
   else
      tbParam.Filtered := false;

   tbParam.Open();

   gdParam.Columns[ tbParam.fieldByName('nm_param').index ].Width := 150;
   gdParam.Columns[ tbParam.fieldByName('uo').index ].Width := 40;
   gdParam.Columns[ tbParam.fieldByName('valor').index ].Width := 300;
   gdParam.Columns[ tbParam.fieldByName('obs').index ].Width := 300;
end;

procedure TfmParametros.FormActivate(Sender: TObject);
var
   lst:TstringList;
   i:integer;
begin
    lst := funcsql.getListagem('Select distinct nm_param from zcf_paramGerais order by nm_param', fmMain.Conexao);
    for i:=0 to lst.Count -1 do
       cbParametros.Items.Add(lst[i]);
end;

procedure TfmParametros.FormClose(Sender: TObject;  var Action: TCloseAction);
begin
   action := caFree;
   fmParametros := nil;
   carregaListaParametros();   
end;

procedure TfmParametros.cbParametrosChange(Sender: TObject);
begin
   carregaListaParametros()
end;

end.


